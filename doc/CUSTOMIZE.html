<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=euc-jp">
<link rel="stylesheet" type="text/css" href="std.css">
<link rel="stylesheet" type="text/css" href="manual.css">
<title>Customize mouse-processor setting file</title>
</head>
<body>

<h1>Customize mouse-processor setting file</h1>

<h2>Introduction</h2>

<p>
このドキュメントでは mouse-processor の設定ファイルの内容 (書式、パラメータ等) について説明します。<br>
付属の設定ファイル <a href="../default.mprc"><span class="fname">default.mprc</span></a> で一通りの機能を利用できますが、
設定ファイルをカスタマイズすることで、より自分好みの動作をするよう設定を変更することができます。
</p>


<h2>Setting file</h2>

<p>
設定ファイルはコマンドライン引数、または所定の場所から検索されます。
</p>

<ul>
<li>コマンドライン引数で設定ファイルを指定した場合は他の場所からの検索は行なわれません。</li>
<li>コマンドライン引数を指定しなかった場合は以下の場所を順に検索し、最初に見付かったファイルを使用します。
  <ul>
  <li>環境変数 <span class="env">HOME</span> が設定してある場合、そのディレクトリにある <span class="fname">.mprc</span> ファイル。</li>
  <li><span class="fname">mp.exe</span> と同じディレクトリにある <span class="fname">default.mprc</span> ファイル。</li>
  </ul>
</li>
</ul>


<h2>File format</h2>

<h3>Character Encoding</h3>

<p>
設定ファイルの文字エンコードは UTF-8 です。
ASCII 文字以外、例えば日本語等を含める場合には必ず UTF-8 でファイルを保存して下さい。
</p>


<h3>Syntax</h3>

<p>
設定はS式で表記され、主に連想リストで構成されます。
各設定項目は、項目名をあらわすシンボルから始まるリストとなります。<br>
S式の詳細については <a href="#appendix:s-exp">Appendix: S-Expression</a> で説明していますが、通常はそれほど意識する必要も無いでしょう。
</p>

<p>
このドキュメントでは以下のような表記をします。
(表示環境によっては区別できない場合があります)
<dl class="ref">
<dt><code><span class="var">some-value</span></code></dt>
<dd>
設定可能な項目をあらわします。<br>
設定内容については各項目の説明を参照して下さい。
</dd>

<dt><code>[<span class="var">some-value</span>]</code></dt>
<dd>
省略可能な設定項目をあらわします。<br>
設定内容および省略時の設定については各項目の説明を参照して下さい。
</dd>

<dt><code><span class="omit">...</span></code></dt>
<dd>
設定項目、設定内容を省略していることをあらわします。<br>
他の設定を指定可能ですが、説明上繁雑となるため省いています。
</dd>

</dl>
</p>


<h3>Setting</h3>

<dl class="ref">
<dt><code>global</code> 設定</dt>
<dd>
<code>global</code> 設定項目では全体の動作に影響する以下の設定を記述できます。
  <dl>

  <dt><code>(combination-time . <span class="var">threshold-time</span>)</code></dt>
  <dd>
  2ボタン同時押しを認識する最大の時間間隔をミリ秒単位で指定します。<br>
  1つめのボタンを押してから、<code><span class="var">threshold-time</span></code> ミリ秒以内に2つめのボタンを押すと、2ボタン同時押しをされたものと認識します。<br>
  この時間を過ぎるとそれぞれのボタンを個別に押したものとされます。
  また、この時間内であっても2つめのボタンを押す前にマウスを動かしたり他のボタンを動作させると、2ボタン同時押しとは認識されません。
  2ボタン同時に押したときと離したときの両方の動作を指定しなかったとき (<a href="#act:nothing"><code>nothing</code></a> を指定したとき) も同様に2ボタン同時押しとは認識されません。
  <div class="ex">
  例: 時間間隔を 0.5 秒に設定
<pre>
(global
 (combination-time . 500)
 <span class="omit">...</span>
 )
</pre>
  </div>
  </dd>

  <dt><code>(tray-icon <span class="var">icon-file</span> [<span class="var">index</span>])</code></dt>
  <dd>
  タスクトレイに表示するアイコンを指定します。<br>
  文字列 <code><span class="var">icon-file</span></code> で指定されたファイルの <code><span class="var">index</span></code> 番目のアイコンを利用します。
  指定可能なファイルは、<span class="fname">.ico</span> ファイルや <span class="fname">.exe</span>、<span class="fname">.dll</span> ファイルなどがあります。<br>
  <code><span class="var">index</span></code> を省略すると <code>0</code> を指定したものとされます。<br>
  <code><span class="var">icon-file</span></code> に <code>#f</code> を指定するとタスクトレイにアイコンを表示しなくなります。
  ただし、この場合はトレイアイコンからのメニュー等も利用できなくなりますので、十分注意して下さい。
  <div class="ex">
  例: 「マウス」コントロールパネルのマウスアイコンを利用
<pre>
(global
 (tray-icon "main.cpl" 0)
 <span class="omit">...</span>
 )
</pre>
  </div>
  </dd>

  </dl>
</dd>

<dt><code>normal-mode</code>、<code>scroll-mode</code> 設定</dt>
<dd>
<code>normal-mode</code> および <code>scroll-mode</code> 設定項目では、
それぞれ通常モードとスクロールモードの動作を記述します。<br>
通常モードはマウス移動が可能なモードで、普段利用するときのボタン割り当てなどを設定します。
スクロールモードはウィンドウスクロール時のモードです。<br>
各モードは複数の動作設定をもつことができ、それぞれに名前 (モード名) をつけられます。
各動作設定は、先頭がモード名であるリストとして記述します。
<div class="ex">
例: <code>abc</code>、<code>def</code> という名前の2つの通常モードと、<code>uvw</code>、<code>xyz</code> という名前の2つのスクロールモードを設定
<pre>
(normal-mode
 (abc
  <span class="omit">...</span>
  )

 (def
  <span class="omit">...</span>
  )
 )

(scroll-mode
 (uvw
  <span class="omit">...</span>
  )

 (xyz
  <span class="omit">...</span>
  )
 )
</pre>
</div>

<div class="mode-spec">
各モード設定には以下のイベント発生時の動作を記述できます。
  <dl>
  <dt><a name="evt:button-d"><code>(button-d-<span class="var">X</span> (<span class="var">action</span> [<span class="var">args</span>]))</code></a></dt>
  <dt><a name="evt:button-u"><code>(button-u-<span class="var">X</span> (<span class="var">action</span> [<span class="var">args</span>]))</code></a></dt>
  <dd>
  それぞれ、ボタンを押したときと離したときの動作を指定します。<br>
  <code><span class="var">X</span></code> には1から5までのボタン番号を指定します。<br>
  <code><span class="var">action</span></code> には、どのような動作をするかを次のいずれかから指定します。
    <ul>
    <li><a href="#act:button-d"><code>button-d</code></a></li>
    <li><a href="#act:button-u"><code>button-u</code></a></li>
    <li><a href="#act:normal-mode"><code>normal-mode</code></a></li>
    <li><a href="#act:scroll-mode"><code>scroll-mode</code></a></li>
    <li><a href="#act:set-scroll-ratio"><code>set-scroll-ratio</code></a></li>
    <li><a href="#act:mul-scroll-ratio"><code>mul-scroll-ratio</code></a></li>
    <li><a href="#act:nothing"><code>nothing</code></a></li>
    </ul>
  <code><span class="var">args</span></code> には <code><span class="var">action</span></code> への引数を指定できます。<br>
  各 <code><span class="var">action</span></code> および <code><span class="var">args</span></code> については、それぞれの説明を参照して下さい。
  </dd>

  <dt><a name="evt:button-d-cmb"><code>(button-d-<span class="var">X+Y</span> (<span class="var">action</span> [<span class="var">args</span>]))</code></a></dt>
  <dt><a name="evt:button-u-cmb"><code>(button-u-<span class="var">X+Y</span> (<span class="var">action</span> [<span class="var">args</span>]))</code></a></dt>
  <dd>
  それぞれ、2ボタン同時に押したときと離したときの動作を指定します。<br>
  <code><span class="var">X</span></code> と <code><span class="var">Y</span></code> には1から5までのボタン番号で2ボタン同時押しの組み合わせを指定します。<br>
  <code><span class="var">action</span></code> には、どのような動作をするかを次のいずれかから指定します。
    <ul>
    <li><a href="#act:button-d"><code>button-d</code></a></li>
    <li><a href="#act:button-u"><code>button-u</code></a></li>
    <li><a href="#act:normal-mode"><code>normal-mode</code></a></li>
    <li><a href="#act:scroll-mode"><code>scroll-mode</code></a></li>
    <li><a href="#act:set-scroll-ratio"><code>set-scroll-ratio</code></a></li>
    <li><a href="#act:mul-scroll-ratio"><code>mul-scroll-ratio</code></a></li>
    <li><a href="#act:nothing"><code>nothing</code></a></li>
    </ul>
  <code><span class="var">args</span></code> には <code><span class="var">action</span></code> への引数を指定できます。<br>
  各 <code><span class="var">action</span></code> および <code><span class="var">args</span></code> については、それぞれの説明を参照して下さい。
  </dd>

  <dt><a name="evt:wheel"><code>(wheel (<span class="var">action</span> [<span class="var">args</span>]))</code></a></dt>
  <dd>
  マウスホイールを動かしたときの動作を指定します。<br>
  <code><span class="var">action</span></code> には、どのような動作をするかを次のいずれかから指定します。
    <ul>
    <li><a href="#act:wheel-input"><code>wheel-input</code></a></li>
    <li><a href="#act:post-wheel-message"><code>post-wheel-message</code></a></li>
    <li><a href="#act:nothing"><code>nothing</code></a></li>
    </ul>
  <code><span class="var">args</span></code> には <code><span class="var">action</span></code> への引数を指定できます。<br>
  各 <code><span class="var">action</span></code> および <code><span class="var">args</span></code> については、それぞれの説明を参照して下さい。
  </dd>
  </dl>
</div>

<div class="mode-spec">
スクロールモードの設定には以下の設定を記述できます。
  <dl>
  <dt><a name="mode-spec:scroll-ratio"><code>(scroll-ratio <span class="var">x-ratio</span> <span class="var">y-ratio</span>)</code></a></dt>
  <dd>
  スクロール速度を指定します。<code>scroll-mode</code> 内でのみ有効です。<br>
  <code><span class="var">x-ratio</span></code> および <code><span class="var">y-ratio</span></code> は、それぞれ X 方向 (横)、Y 方向 (縦) のスクロール速度で、何倍の速度でスクロールするかを指定します。
  負の数を指定するとスクロールの向きが逆になります。
  <div class="ex">
  例: 横を半分、縦を逆向きに2倍の速度でスクロール
<pre>
(scroll-mode
 (half-x-reverse-double-y
  (scroll-ratio 0.5 -2)
  <span class="omit">...</span>
  )
 )
</pre>
  </div>
  </dd>
  </dl>
</div>

<div class="mode-spec">
各動作設定で <code><span class="var">action</span></code> として指定できる設定には以下のものがあります。
  <dl>
  <dt><a name="act:button-d"><code>(butto-d <span class="var">N</span>)</code></a></dt>
  <dt><a name="act:button-u"><code>(butto-u <span class="var">N</span>)</code></a></dt>
  <dd>
  それぞれ、ボタンを押す動作と離す動作を割り当てます。<br>
  <code><span class="var">N</span></code> には1から5までのボタン番号を指定します。<br>
  この動作を指定できるのは以下のイベント設定です。
    <ul>
    <li><a href="#evt:button-d"><code>button-d-<span class="var">X</span></code></a></li>
    <li><a href="#evt:button-u"><code>button-u-<span class="var">X</span></code></a></li>
    <li><a href="#evt:button-d-cmb"><code>button-d-<span class="var">X+Y</span></code></a></li>
    <li><a href="#evt:button-u-cmb"><code>button-u-<span class="var">X+Y</span></code></a></li>
    </ul>
  <div class="ex">
  例: ボタン3をクリックしたとき、ボタン5のクリックとして動作するよう割り当てます。
<pre>
(normal-mode
 (some-name
  (button-d-3 (button-d 5))
  (button-u-3 (button-u 5))
  )
 )
</pre>
  </div>
  </dd>

  <dt><a name="act:normal-mode"><code>(normal-mode <span class="var">mode-name</span>)</code></a></dt>
  <dd>
  現在の動作モードを通常モードに切り替えます。<br>
  <code><span class="var">mode-name</span></code> には切り替え後の通常モードのモード名を指定します。<br>
  この動作を指定できるのは以下のイベント設定です。
    <ul>
    <li><a href="#evt:button-d"><code>button-d-<span class="var">X</span></code></a></li>
    <li><a href="#evt:button-u"><code>button-u-<span class="var">X</span></code></a></li>
    <li><a href="#evt:button-d-cmb"><code>button-d-<span class="var">X+Y</span></code></a></li>
    <li><a href="#evt:button-u-cmb"><code>button-u-<span class="var">X+Y</span></code></a></li>
    </ul>
  <div class="ex">
  例: ボタン3のクリックがボタン4として動作するモード <code>mode-A</code> と、ボタン3のクリックがボタン5として動作するモード <code>mode-B</code> の2つの通常モードをボタン1と2の同時押しで切り替える
<pre>
(normal-mode
 (mode-A
  (button-d-1+2 (normal-mode mode-B))
  (button-d-3 (button-d 4))
  (button-u-3 (button-u 4))
  )

 (mode-B
  (button-d-1+2 (normal-mode mode-A))
  (button-d-3 (button-d 5))
  (button-u-3 (button-u 5))
  )
 )
</pre>
  </div>
  </dd>

  <dt><a name="act:scroll-mode"><code>(scroll-mode <span class="var">mode-name</span>)</code></a></dt>
  <dd>
  現在の動作モードをスクロールモードに切り替えます。<br>
  <code><span class="var">mode-name</span></code> には切り替え後のスクロールモードのモード名を指定します。<br>
  この動作を指定できるのは以下のイベント設定です。
    <ul>
    <li><a href="#evt:button-d"><code>button-d-<span class="var">X</span></code></a></li>
    <li><a href="#evt:button-u"><code>button-u-<span class="var">X</span></code></a></li>
    <li><a href="#evt:button-d-cmb"><code>button-d-<span class="var">X+Y</span></code></a></li>
    <li><a href="#evt:button-u-cmb"><code>button-u-<span class="var">X+Y</span></code></a></li>
    </ul>
  <div class="ex">
  例: 通常モード <code>mode-N</code> 時にボタン1と2を同時押ししている間だけスクロールモード <code>mode-S</code> に切り替え、ボタンを離すと通常モードに戻る
<pre>
(normal-mode
 (mode-N
  (button-d-1+2 (scroll-mode mode-S))
  <span class="omit">...</span>
  )
 )

(scroll-mode
 (mode-S
  (button-u-1+2 (normal-mode mode-N))
  <span class="omit">...</span>
  )
 )
</pre>
  </div>
  </dd>

  <dt><a name="act:set-scroll-ratio"><code>(set-scroll-ratio <span class="var">x-ratio</span> <span class="var">y-ratio</span>)</code></a></dt>
  <dd>
  スクロール速度を設定しなおします。<code>scroll-mode</code> 内でのみ有効です。<br>
  <code><span class="var">x-ratio</span></code> と <code><span class="var">y-ratio</span></code> の意味は <a href="#mode-spec:scroll-ratio"><code>scroll-ratio</code></a> と同じです。<br>
  この動作を指定できるのは以下のイベント設定です。
    <ul>
    <li><a href="#evt:button-d"><code>button-d-<span class="var">X</span></code></a></li>
    <li><a href="#evt:button-u"><code>button-u-<span class="var">X</span></code></a></li>
    <li><a href="#evt:button-d-cmb"><code>button-d-<span class="var">X+Y</span></code></a></li>
    <li><a href="#evt:button-u-cmb"><code>button-u-<span class="var">X+Y</span></code></a></li>
    </ul>
  </dd>

  <dt><a name="act:mul-scroll-ratio"><code>(mul-scroll-ratio <span class="var">x-ratio</span> <span class="var">y-ratio</span>)</code></a></dt>
  <dd>
  スクロール速度を変更します。<code>scroll-mode</code> 内でのみ有効です。<br>
  <a href="#mode-spec:scroll-ratio"><code>scroll-ratio</code></a>、<a href="#act:set-scroll-ratio"><code>set-scroll-ratio</code></a> で設定した X 方向のスクロール速度に <code><span class="var">x-ratio</span></code> を乗じ、Y 方向のスクロール速度に <code><span class="var">y-ratio</span></code> を乗じます。<br>
  この動作を指定できるのは以下のイベント設定です。
    <ul>
    <li><a href="#evt:button-d"><code>button-d-<span class="var">X</span></code></a></li>
    <li><a href="#evt:button-u"><code>button-u-<span class="var">X</span></code></a></li>
    <li><a href="#evt:button-d-cmb"><code>button-d-<span class="var">X+Y</span></code></a></li>
    <li><a href="#evt:button-u-cmb"><code>button-u-<span class="var">X+Y</span></code></a></li>
    </ul>
  <div class="ex">
  例: ボタン3を押すたびにスクロール方向が逆転するスクロールモード
<pre>
(scroll-mode
 (some-name
  (button-d-3 (mul-scroll-ratio -1 -1))
  <span class="omit">...</span>
  )
 )
</pre>
  </div>
  </dd>

  <dt><a name="act:wheel-input"><code>(wheel-input)</code></a></dt>
  <dd>
  通常のホイールを回転させたときの動作と同じです。<br>
  この動作を指定できるのは以下のイベント設定です。
    <ul>
    <li><a href="#evt:wheel"><code>wheel</code></a></li>
    </ul>
  </dd>

  <dt><a name="act:post-wheel-message"><code>(post-wheel-message)</code></a></dt>
  <dd>
  ホイールを回転させたときに発生するメッセージをマウスカーソル直下のウィンドウに送信します。<br>
  通常、ホイールメッセージはキーフォーカスがあるウィンドウに送信されますが、その動作を変更させます。
  これにより、アクティブでないウィンドウや後ろの方にあるウィンドウへダイレクトにホイールメッセージを送れます。<br>
  この動作を指定できるのは以下のイベント設定です。
    <ul>
    <li><a href="#evt:wheel"><code>wheel</code></a></li>
    </ul>
  </dd>

  <dt><a name="act:nothing"><code>(nothing)</code></a></dt>
  <dd>
  何も行ないません。<br>
  特定のボタンを無効にしたいときなどに指定します。<br>
  この動作は全てのイベント設定で指定できます。
  </dd>
  </dl>
</div>

</dd>

<dt><code>scroll-window</code> 設定</dt>
<dd>
</dd>

<dt><code>operator-config</code> 設定</dt>
<dd>
</dd>
</dl>


<h2><a name="appendix">Appendix</a></h2>

<h3><a name="appendix:s-exp">S-Expression</a></h3>

<p>
S式は以下の要素で構成されます。
</p>

<dl>
<dt>コメント</dt>
<dd>
";" (セミコロン) から、その行の末尾まではコメントとして扱われます。
</dd>

<dt>整数</dt>
<dd>
数値を表わします。
接頭辞 #o #d #x を付けることで、それぞれ8進数、10進数、16進数で表記できます。
<div class="ex">
例: 以下は全て10進数の 26 と同じ値になります。
<pre>
26  #o32  #d26  #x1A
</pre>
</div>
</dd>

<dt>浮動小数点数</dt>
<dd>
数字に小数点 "." を含めることで有限精度の実数を表記できます。
</dd>

<dt>シンボル</dt>
<dd>
アルファベットや記号で構成され、機能名などに用いられる識別子です。
</dd>

<dt>文字列</dt>
<dd>
ダブルクオーテーション (二重引用符、"")でくくられ、任意の文字を含めることができます。
ダブルクオーテーションを含める場合は直前に "\" を前置します。"\" 自身を含めたい場合も同様です。
</dd>

<dt>真偽値</dt>
<dd>
真および偽をあらわします。<br>
偽は <code>#f</code>、真は <code>#f</code> 以外となります。
明示的に真をあらわす <code>#t</code> もあります。
</dd>

<dt>cons セル</dt>
<dd>
car 部と cdr 部の二つで構成され、それぞれに任意の値を入れることができます。
car と cdr の間を "." で区切り、全体を括弧 () でくくって表記します。
<div class="ex">
例: car 部に "car" というシンボル、cdr 部に "cdr" という文字列を入れた cons セルは、以下のように表記します。
<pre>
(car . "cdr")
</pre>
</div>
</dd>

<dt>リスト</dt>
<dd>
リストは cons セルの連なりで構成されます。<br>
n個の要素を持つリストは n個の cons セルで構成され、それぞれの car 部は要素を cdr 部は次の cons セルを保持します。最後の cdr 部は空リスト <code>()</code> を保持します。
<div class="ex">
例: 4つの要素を持ち、それぞれの要素が整数のリストは以下のように表記します。
<pre>
(1 . (2 . (3 . (4 . ()))))
</pre>
</div>
このままでは表記が繁雑となるため、cdr 部が cons セルの場合は、car 部と cdr 部の間のドットと cdr 部をくくる括弧は省略することができます。
<div class="ex">
例: 以下は全て同じリストを表わします。
<pre>
(1 2 3 4)
(1 . (2 3 4))
(1 . (2 . (3 . (4 . ()))))
</pre>
</div>
</dd>
</dl>

<hr>

<address>
webmaster@tamanegi.org
</address>

<!-- $Id: CUSTOMIZE.html,v 1.2 2005/01/26 09:36:33 hos Exp $ -->

<!--
Local Variables:
coding: euc-jp
End:
-->

</body>
</html>
